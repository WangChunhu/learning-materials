library(data.table)
library(openxlsx)
hu <- read.xlsx("H:/RÑ§Ï°/Á·Ï°/Á·Ï°.xlsx",colNames=TRUE)
hu1 <- setDT(hu)   #????data.table
HU1 <- copy(hu1)   #??Îªdata.table?Ô´???Ö·?Ä·?Ê½Ö±???Þ¸?Ô­??????Ã»?Ð¿???
a <- data.frame(summary(hu1))
nrow(hu1)
ncol(hu1) 
names(hu1)
head(hu1[,!2:3])   #??È¡2,3?Ðµ?Ç°6??(????À¨????)
hu2 <- hu1[3:10]   #Ñ¡?Ð£???Á¿??
hu4 <- hu1[!1:4]   #Ñ¡È¡??????
hu5 <- hu1[GY_H > 10 & IR_H > 350 & GY_E >5]   #??Í¬??Á¿ 
hu10 <- hu1[Cultivar %in% c("Y-Lliangyou 900","Shanyou63")]   #Í¬Ò»??Á¿??Í¬???é£¨?????????????ã£©
hu6 <- hu1[,names(hu1) %like% "IR"]   #Ä£??Ñ¡??
hu7 <- hu[,.(Cultivar)]   # .???? ????Ò»??data.table?????í²»?Ç£?
setnames(hu1,"IR_H","IR_2")   #??????Á¿??????
setnames(hu1,c("GY_H","IR_2"),c("GY_1","IR_H"))   #??????Á¿??????
setcolorder(hu1,c(1L,4L,2L,3L,5L))   #?Þ¸??Ðµ?Ë³??
setcolorder(c(4L,1L:3L))
hu9 <- setorder(hu1,Cultivar,-IR_H)   #????Á¿??????
#with Ä¬????TRUE???????Ü¹???????Á¿Ê¹??,??x?àµ±??DT$"x"
#key
mydata[origin %in% c("JFK", "LGA")]
mydata[c("JFK", "LGA")]
#?Ô¶?????Á¿????????
setkey(mydata, origin, dest)
mydata[.("JFK", "MIA")]
#???????????????Ý²???Ð§??
setkey(hu1,Cultivar)   #?É¶???????
hu11 <- hu1[!c("Y-Lliangyou 900","Shanyou63")]   #Í¬Ò»??????Á¿
setkey(hu1,Cultivar,GY_H)
hu12 <- hu1[!.("Y-Lliangyou 900",4.42)]   #??Í¬??Á¿

# Ê¹??:= ???Ó»?????Ò»?Ð£???À¨?Å¼?Ë«???Å£?
hu12 <- hu1[,IR_I := IR_I*2]   #????Ò»??
hu14 <- hu1[,c("IR_I","GY_1"):=list(IR_I*2,GY_1*2)]   #???Â¶???
hu13 <- hu1[,IR_2 := IR_I*2]   #????Ò»??
hu15 <- hu1[,c("IR_a","GY_a"):=list(IR_I*2,GY_1*2)]   #???Ó¶???
hu16 <- hu1[,Cultivar:= NULL]  #?Æ³???
hu17 <- hu1[,c("IR_I","GY_1"):=  NULL] 

#%$%????Ê¾???Ò´????Ð£???????Ö±?Ó°??Ð²???
data = data%>% 
  as.data.table()%$% 
  .[,.(value = sum(value,na.rm = TRUE)),
    by = c("period","index","area","id1","id2")]

#?Ä±????????Ð±?Á¿????
data = data%$%
  .[index_name == "DB",index_name := "DB_PV"]%$%
  .[index_name == "GZ",index_name := "GZ_UV"]%$%
  .[index_name == "XSLZ",index_name := "XSLZ_UV"]

#É¸Ñ¡????
N <- rank.P[ID2%in%target,.(ID2, Month, prov_ID, Province, Index_name,Value_adj_per)]

#É¸Ñ¡Ä³????Ã¿????????Ç°20??
P <- rank.P[ID2%in%target,
            .SD[1:20],
            by = c("ID2","Month","prov_ID","Province","Index_name")]

#????
hu1[,.(mean(IR_H)),by=.(Cultivar,IR_E)]
hu1[,.N,by=.(Cultivar,IR_E)]   #?é¿´????????
.hu1[,{print(IR_H)
  plot(GY_H)
  NULL}]   #????????Ê½???Ô°????Ú»?À¨????


#???Ý¾Ûº?
hu1[,.(mean=mean(GY_H,na.rm = TRUE),
       median=median(GY_H,na.rm =TRUE),
       min=min(GY_H,na.rm = TRUE),
       max=max(GY_H,na.rm = TRUE)
       )]   #??????Á¿
hu1[,.(mean(GY_H,na.rm =TRUE),mean(GY_E))]   #??????Á¿
hu1[,sapply(.SD,meadata <- data.table(x <- c(rep("a",3),rep("b",4),rep("c",5)),
                   y <- 1:12,
                   z <- 13:24)
data.table(data[,lapply(.SD,mean),.SDcols = c("V2","V3"),by = "V1"])
data.table(data[,lapply(.SD,function(x) c(mean(x),sd(x),min(x))),.SDcols = c("V2","V3"),by = "V1"])?Úµ?????

#.SD????  ( .SD??Ò»??data.table?????????Ë¸??????é£¬????by?ÐµÄ±?Á¿??????Ôª?Ø¡?.SDÖ»????Î»??j??Ê¹?Ã£?
hu1[,print(.SD),by=Cultivar]  #?Ô·???????Ê½???????Ð±?Á¿
hu1[,.SD[c(1,.N)],by=Cultivar]   #?Ô·???????Ê½???????Ð±?Á¿?Äµ?Ò»?Ðº?????Ò»??

#Ö±???Þ¸?Ä³??Î»?Ãµ?Öµ
#set(DT,rownum,colnum,value)
HU1 <- copy(hu1)
 for (i in 1:nrow(hu1))set(hu1,i,1L,"a")
HU1
set(HU1,2L,1L,"b")

#by??on??with?È²???
#by???????Ý½??Ð·???
#on????ÁªÆ¥??
a <- hu1[HU1,on=c("Cultivar","GY_E")]   #È¡hu1??"x","y"??????HU1??"x","y????????Áª???Ð£?????D????merge
hu20 <- hu1[HU1,on="Cultivar"]
hu21 <- HU1[hu1,on="Cultivar"]
hu22 <- hu1[HU1,on="Cultivar",nomatch=0]  #nomatch=NA??Ê¾??NA???Ø²?Æ¥????Öµ
#withÄ¬????TRUE???????Ü¹???????Á¿Ê¹??
a <- letters[11:20]
b <- letters[1:10]
c <- LETTERS[1:10]
A <- data.table(a,b)
B <- data.table(b,c)
setnames(B,c("b","c"),c("a","b"))
A[B,on=c("a","b")]
A[B,on="a"]
B[A,on="b"]
A["b",on="a",mult="last"]   #????i ??Æ¥?äµ½???Ð¶???Ê±??mult???Æ·??Øµ???

#reshape
setcolorder(hu1,c(1L,4L,2L,3L,5L))   #?Þ¸??Ðµ?Ë³??
#setnames(hu1,c("Cultivar","IR_E"),c("id","x"))
dcast(HU1,Cultivar~IR_E,
              value.var = c("IR_H","GY_H","GY_E"))
melt(hu1,
        id.vars = c("Cultivar"),
        measure = patterns("^IR_H","^GY_H"),
        variable.name = "IR_E",
        value.name=c("IR_H","GY_H","GY_E"))

a <-rep(LETTERS[1:2],each=3)
b <-rep(c(1,2),times=3)
c <-c(4,6,5,9,8,5)
d <-rep(letters[6:11])
e <-data.frame(a,b,c,d)
f <-setDT(e)
g <-copy(f)
dcast(g,
      a~b,
      value.var = c("c","d"))

library(tidyr)   
label <- unite(hu9,"msg",mean_IRH,sg,sep = "")   #?Ï²?Á½??ÎªÒ»?Ð£?Æ½??Öµ+?????Ô£?

#?????Ô¼???
#pearson(Æ¤??Ñ·????Ïµ??)
a <- c(1,2,4,4,5,6,6,8,8,10)
b <- c(2,1,4,8,8,12,14,18,14,20)
cor.test(a,b,method = "pearson")   #pÖµ?Ç½??Û²???????Îª??Ð§???????????????ÔµÄ·??????Ê¡???p=0.05??Ê¾?????Ð±?Á¿??Áª??5%?Ä¿?????????Å¼È»?????ÉµÄ¡?method="spearman"/"kendall"   [??t??pÖµ]
cor(a,b,method = "pearson")   #[Ö»??????Ïµ??]

#????????
#?????Ø·????????????Ø±È½?
require(agricolae)
require(data.table)
require(magrittr)

wang <- c("??","??","??","??","??","??")
chun <- c(1:6)
hu <- data.table(wang,chun)
hu.aov <- aov(chun~wang,hu) ##??????$Ñ¡??Á¿?????????Å£?Ö±??Ð´??Á¿
hu.lsd <- LSD.test(hu.aov,"wang",p.adj = "none",alpha = 0.05)
hu.lsd$groups  #????????
LETTER <- R1[,2]

#???Ú´???(???â²¿????À´Îª?Ö·???????r????Ð´Îª"yyyy-mm-dd")
Sys.Date()   #???Øµ?Ç°????
Sys.time()
date()   #???Øµ?Ç°???Úº?Ê±??
scale_x_date(date_labels ="%d-%b")
as.Date("2007??2??1??", "%Y??%m??%d??") 

hu <- read.xlsx("H:/RÑ§Ï°/Á·Ï°/????Á·Ï°.xlsx",colNames = T,detectDates = T)

today <- Sys.Date()
format(x = hu$??,"%Y??%m??%d??")
format(x = hu$??,"%a")
as.character(today, format="%Y??%m??%d??")   #?Ö·???×ª??Îª?Ö·???
time <- Sys.time()
format(time, "%Y??%m??%d??%HÊ±%M??%S??")
as.character(time, format="%Y??%m??%d??%HÊ±%M??%S??")
dob <- as.Date("1996/10/12")

difftime(today,dob,units ="auto" )   #????Ê±??????

#????????Ê½.  (????Ò»??Î»?Ãµ??Ö·?????)
"^" # Æ¥??Ò»???Ö·????Ä¿?Ê¼
  sub("^a","",c("abcd","dcba"))
"$ "# Æ¥??Ò»???Ö·????Ä½???  
  sub("a$","",c("abcd","dcba"))
"." #??Ê¾???Ë»??Ð·?????????Ò»?Ö·?
  sub("a.c","",c("abcd","sdacd"))
"*" #Ê¾????Ç°???Ö·?????0??????????Æ¥??
  sub("a*b","",c("aabcd","dcaaaba"))

#?Ì±ä³¤
  melt.data.table(data = shanghai,id.vars=c("year"),variable.name="chidu")

#??NA???É¿?Öµ 
tidyr::replace_na() 


